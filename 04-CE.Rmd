# Code Enforcement

<!--# According to Sharon Hyde, head of the Memphis branch of the Green and Healhty Homes Initiative, Code Enforcement has been trained to identify healthy home hazards, though it has been a few years. The system is currently being used by the Shelby County Department of Housing for their LEAD grant program, which is funded by HUD and requires a healthy home inspection for each project. -->

## Reports

Over the past twenty years, there have been at least two expansive reports offering critiques and criticisms of Memphis code enforcement. While each report aimed to improve code enforcement, the reasons differed---one sought to address crime and safety, the other public health.

The first report, released in April 2001, was distributed by the Memphis Shelby Crime Commission and written by Phyllis Betts, then a professor of sociology at University of Memphis [@betts2001]. Input was provided by two other University of Memphis faculty: Betts's husband, the late Richard Janikowski, former chair of the Department of Criminology and Criminal Justice and 'father' of Memphis's Blue CRUSH policing [@poe2021]; and Susan Roakes, former professor of City and Regional Planning.

The report was built on the "broken windows" criminology theory: in deteriorated or declining neighborhoods, physical neglect of "problem properties" attracts and aggravates criminal activity. Researchers interviewed inspectors and individuals involved with environmental court, used code enforcement data from 1992-1999, accessed the Shelby County Tax Assessor's database, and conducted visual surveys for selected properties as part of a case study of the Binghamton neighborhood.

The second report, published in 2018, was produced by The Urban Institute [@stacy2018]. While the 2001 report focused on property neglect and safety, this report centered on the link between the physical condition of homes and neighborhoods and public health. Planning for the report began shortly after the election of Mayor Jim Strickland in 2016, whose campaign had emphasized blight control [@baker2018]. Researchers collaborated with and interviewed members of the newly formed [Blight Elimination Steering Team](http://memphisfightsblight.com/blight-elimination-steering-team/), a coordinated effort between public, private, and nonprofit agencies to address blight, and the [Green and Healthy Homes Initiative](https://www.greenandhealthyhomes.org/location/memphis-tn/), a partnership formed between local health care providers and housing and community development organizations to address public health issues related to housing quality.

The report accessed and analyzed data through the [Memphis Property Hub](http://memphisfightsblight.com/programs/mph/), which offers parcel-level property information, particularly related to blighted, vacant, and foreclosed homes. Code enforcement data from 1999-2017 was used, effectively picking up where the last report ended. Additional data related to public health, safety, and courts were provided by the Shelby County Healthy Department, the Center for Applied Earth Science and Engineering Research department at the University of Memphis, and the Shelby County Environmental Court, respectively.

### Findings

In a visual survey of the Binghamton neighborhood, @betts2001 found that only about 1 in 5 code violations were reported.

Both reports found the vast majority of code enforcement reports were related to nonstructural issues. @betts2001 reported three out of four properties were cited for non-structural problems such as weeds, junk, and inoperable or abandoned vehicles. It appears this percentage has actually increased overtime; @stacy2018 stated 81% of all requests concerned the yard or property, rather than the house.

@stacy2018 found service requests were concentrated in areas with single-family homes, and though about half of all requests were for multifamily units, most of these (70 percent) were for duplexes rather than apartment complexes. @betts2001 also found that large multifamily units flew under the radar; at least half of multifamily properties in Binghamton had violations in multiple units, yet code enforcement recorded only eight violations out of 1200 apartment units.

It appears the number of service requests has increased overtime. In 1998, code enforcement received about 10,000 complaints [@betts2001 93], while the Urban Institute reported 53,226 in 2016 [@stacy2018 51]. However, this number does not match open data (discussed later in this paper) which reported 30,361 requests in 2016, not excluding duplicates. Nevertheless, it does appear that more requests are being made.

Cases also appear significantly more likely to be taken to court. In 1998, a mere 71 cases from code enforcement were heard by the environmental court [@betts2001 49]. In November 2017 alone, 1,095 cases went to environmental court, though the Urban report does not specifically state if all cases were from code enforcement [@stacy2018 51]. However, the majority of cases were for single-family homes (64%), and most were vacant.

### Recommendations

Both reports recommend fundamentally changing Memphis code enforcement from a reactive process (responding to citizen reports) to a proactive, strategic system.

@stacy2018 suggests that code enforcement prioritize health-related violations and interior health and safety issues, cemented through the agency's policies and procedures manual. The authors recommend proactive inspections of problem multifamily properties and under-served neighborhoods, and identification of under-reported violations. Multiple technology improvements are recommended, including automatic prioritization of health-related violations and synchronizing of data systems with the Shelby County Department of Health and the environmental court, among others. Also acknowledged is the need to update current landlord/tenant laws to protect tenants from homelessness.

<!--# add a lot more -->

## 311 Data

Memphians are able to report problems to code enforcement by calling 311 or submitting a request through an app called [SeeClickFix](https://seeclickfix.com/), used in hundreds of towns across the nation.

Housing code enforcement data from 2016-present is available through [Memphis Data Hub](https://data.memphistn.gov/dataset/Service-Requests-since-2016/hmd4-ddta). This page uses a dataset downloaded July 19, 2021. At the time of download, there were 53 columns and 1,232,097 rows. R/RStudio was used to view and analyze the dataset.

```{r getdata, include=FALSE}
library(tidyverse)
Service_Requests_since_2016 <-
  read_csv(
    "_data/Service_Requests_since_2016.csv",
    col_types = cols(
      ADDRESS2 = "c",
      ADDRESS3 = "c",
      COLLECTION_DAY = "c",
      CLOSE_DATE = col_datetime(format = "%m/%d/%Y %I:%M:%S %p"),
      CREATION_DATE = col_datetime(format = "%m/%d/%Y %I:%M:%S %p"),
      FOLLOWUP_DATE = col_datetime(format = "%m/%d/%Y %I:%M:%S %p"),
      INCIDENT_RESOLVED_DATE = col_datetime(format = "%m/%d/%Y %I:%M:%S %p"),
      LAST_MODIFIED_DATE = col_datetime(format = "%m/%d/%Y %I:%M:%S %p"),
      LAST_UPDATE_DATE = col_datetime(format = "%m/%d/%Y %I:%M:%S %p"),
      NEXT_OPEN_TASK_DATE = col_datetime(format = "%m/%d/%Y %I:%M:%S %p"),
      REPORTED_DATE = col_datetime(format = "%m/%d/%Y %I:%M:%S %p")
    )
  )
```

Each row of the dataset contains all information for a single request, meaning there are not multiple rows for individual cases (except for duplicates).

Despite the large number of records, only a portion are relevant to this paper. This is because the dataset contains **all** requests to 311, not just those related to code enforcement. Additionally, many columns contain duplicate or unhelpful information. For instance, there are 23 columns related to location and under the column `LAST_UPDATED_BY`, every single entry is just the number "460101".

The dataset can be simplified by filtering for code enforcement data and narrowing the number of columns. In the next section I more thoroughly explain why I chose these columns.

**NOTE**: A list of all column names is available on the Data Hub site linked above, or in R/RStudio enter `colnames(Service_Requests_since_2016)`.

```{r CE}
CE <- Service_Requests_since_2016 %>%
  filter(DEPARTMENT == "Code Enforcement") %>%
  select(
    INCIDENT_NUMBER, #' service request (sr) number
    PARCEL_ID, #' parcel ID
    ADDRESS1, #' the street name & number
    REQUEST_TYPE, #' request category
    CE_CATEGORY, #' category for CE action
    RESOLUTION_CODE:RESOLUTION_SUMMARY, #' how the request resolved
    REQUEST_STATUS, #' open or closed?
    REPORTED_DATE, 
    LAST_MODIFIED_DATE, 
    OWNER_NAME, #' assigned code inspector
    CREATED_BY_USER,
    location1 #' geocoordinates
  ) %>% mutate(RESOLUTION_SUMMARY = str_to_lower(RESOLUTION_SUMMARY))
```

The output is 14 columns and 154,844 rows, significantly easier to work with.

### Problems with the dataset

We're ready to begin looking at the data, but before analyzing you should know that there are significant problems with this dataset, including inconsistent and vague data entry, hard-to-filter duplicates, an error causing the wrong address to appear, and more. As such, I was not able to quickly process and analyze this data.

Throughout the dataset, there are **multiple values that mean the same thing**, like closed and resolved[^ce-1]. The `RESOLUTION_CODE` field in particular has a handful of codes used for an umbrella of meanings. For instance, 23% of rows are resolved as "NJ" for Not Justified. This may mean an inspector has visited the property and did not see a problem, or there was a wrong address[^ce-2], or there was a problem and it's been fixed, or there was a problem but it wasn't related to code enforcement; but in most cases there is no further explanation given. There are similar problems for codes tagged CVOM (COMP. V.O. - Miscellaneous, 9% of all cases), CVOID (Closed Void, 4% cases), CO (Closed Other, 3%), and Other (1%). Together, these codes make up [40%]{.ul} of all code enforcement cases.

[^ce-1]: Resolved has only been used 72 times, which begs the question of whether it needs to exist at all.

[^ce-2]: INSUF (Insufficient information) is also used for wrong address cases.

Another field with this problem is `REQUEST_TYPE`. From 2016 to present, 29% of all requests were simply listed as "Code Miscellaneous".

Some problems are caused by a **lack of updates** on behalf of inspectors. A file may never be closed in the system, even though the inspector is finished looking at the case. There are 779 active cases created in 2018 or earlier (at least 2.5 years old) and it is unclear if some are in a lengthy legal battle or were simply never updated.

There are many many **duplicated entries**. It's hard to determine exactly how many, because the duplicates will have unique values under `INCIDENT_NUMBER` and slightly different date/times. For this reason it is hard to filter out without accidentally omitting multiple legitimate entries under the same property. Also, any entries that were created in error are kept in the system. This leads to inspectors frequently entering "see sr\#xxxxxx" in the `RESOLUTION_SUMMARY`, referring to a different `INCIDENT_NUMBER` that contains the correct file.[^ce-3] There is also a code specifically for duplicate entries that already have an active file, JA (Justified, Active already file), which has been used 6,588 times, though other codes are known to be used for this same problem.

[^ce-3]: There are 6,391 instances of a `RESOLUTION_SUMMARY` mentioning "sr", and nearly all of these rows are likely to be duplicates.

**Other problems are more major.** It appears that SeeClickFix (SCF), a program used to allow users to create requests, can cause the **wrong address** to be entered into the system. There is no warning given for this error. When I attempted to sort addresses with the most violations, the top address does not actually exist in the city of Memphis. The inspectors know this and they seem to be able to view the correct address in SCF, and sometimes (but not often) they will manually write this address in the `RESOLUTION_SUMMARY`. It is unclear how many addresses have this problem, but it does affect multiple addresses. As a researcher, I feel nervous conducting research on data with such obvious errors.

Each row is meant to hold all information for a single case. There is also only one column for inspectors to manually enter notes: `RESOLUTION_SUMMARY`. This column has become a **catch-all** for legitimate information, though it is also NA in 23% of rows. In many other cases there is little elaboration, or the `RESOLUTION_CODE_MEANING` is simply repeated. Despite having eight different date columns, it is very common for dates to be entered here with the notes. Because this field is typed, typos are not-uncommon---tenant is spelled "tennant" 51 times, with many other variations such as "tenenat", "tenet", "teneant" and "tenent". Other times a tenant is referred to as a "resident". These variances make it difficult to find all instances of keywords.

Lastly, there are also obvious **privacy issues** included in the field, such as the full name and phone numbers of individuals.

### Duplicates & Errors

Searching for duplicates is made difficult by the large number of errors in the dataset. This is made clear when we begin searching for addresses with the most service requests.

```{r}
CE %>% count(ADDRESS1) %>% arrange(desc(n))
```

There are 194 entries listed under the address 746 Chapel St, an address that does not seem to exist in Memphis (there is a Chapel [Rd]{.ul}, but no 746). Reviewing the `RESOLUTION_SUMMARY` reveals the address to be a catch all of errors. Sometimes a different address or a business name is written in the `RESOLUTION_SUMMARY`, indicating the results we are seeing is not the same as what was originally entered, yet code inspectors may be able to view the correct address. It is likely best to remove this address from any analysis involving location.

At 1490 Hugenot St, there are 117 requests, but this property appears to have the same problem as 746 Chapel. This is revealed by certain entries in the `RESOLUTION_SUMMARY` including "The correct address is xxx Summer Ave." and "INSUFFICIENT INFORMATION WRONG ADDRESS SUBMITTED BY SEECLICKFIX" (SeeClickFix, or SCF, is listed as the request creator for all but five entries at this address).

As for 45 S Idlewild, this is a valid location (an apartment complex) with 117 service requests. A closer look shows three people made 20 requests on February 1, 2019. Yet as discussed below, it is not clear if we should trust the information seen in `CREATED_BY_USER`.

When we look closer at *who* is making complaints to code enforcement, it at first seems a few people are creating an astounding number of requests.[^ce-4]

[^ce-4]: SCF stands for SeeClickFix, an app to create service requests.

```{r}
CE %>% count(CREATED_BY_USER) %>% arrange(desc(n))
```

However, filtering by HELEN.ANDERSON then "tenant" under `RESOLUTION_SUMMARY` shows multiple instances where someone not named "Helen Anderson" is mentioned as the contact person across a wide variety of addresses.

### Analysis

Below is the number of requests for each year between 2016 and 2021, not excluding duplicates.

| Reported Date           | Number of Requests |
|-------------------------|--------------------|
| 2016                    | 30,361             |
| 2017                    | 26,196             |
| 2018                    | 26,846             |
| 2019                    | 27,559             |
| 2020                    | 26,194             |
| 2021 (as of 07/19/2021) | 17,688             |

The number of requests has not changed much over the years.

#### Active Cases

Below is the number of cases still active from each year.

| Year          | Active Cases |
|---------------|--------------|
| 2016          | 136          |
| 2017          | 111          |
| 2018          | 532          |
| 2019          | 956          |
| 2020          | 1,098        |
| 2021          | 5,630        |
| **All Years** | **8,463**    |

There are still 779 active cases from 2018 or earlier.

#### Request Type

When a request is entered into 311, it must also be categorized. There are 14 categories for code enforcement data, including 3 categories related to COVID violations which were added in 2020.

For each year, the vast majority of requests fell into one of five categories, listed below.

|                    Request Type | 2016    | 2017    | 2018    | 2019    | 2020    | 2021    |         All | Years   |
|--------------------------------:|---------|---------|---------|---------|---------|---------|------------:|---------|
|              Code Miscellaneous | 28%     | 32%     | 32%     | 31%     | 25%     | 25%     |  **45,028** | **29%** |
|               Vehicle Violation | 22%     | 26%     | 28%     | 26%     | 30%     | 35%     |  **42,249** | **27%** |
|                  Weeds Occupied | 20%     | 18%     | 17%     | 19%     | 14%     | 11%     |  **26,161** | **17%** |
|                      Junky Yard | 18%     | 13%     | 11%     | 12%     | 12%     | 15%     |  **21,283** | **14%** |
| Substandard, Derelict Structure | 9%      | 8%      | 10%     | 10%     | 7%      | 9%      |  **13,778** | **9%**  |
|                         **Sum** | **97%** | **97%** | **98%** | **98%** | **88%** | **95%** | **148,499** | **96%** |

From 2016 to 2019, more requests were sorted into "Miscellaneous" than any other category (surpassed by vehicle violations in 2020 and 2021).

### Tidying the Dataset

Goal: Not manually alter dataset; instead create a sorting method that anyone can run using the latest dataset.

```{r eval=FALSE, include=FALSE}
dupes <- CE %>% 
  filter(
    str_detect(
      RESOLUTION_SUMMARY, "sr|see#|service request|see #|duplicate") | 
      RESOLUTION_CODE == "JA")

errors <- CE %>% 
  filter(
    str_detect(
      RESOLUTION_SUMMARY, 
      "wrong address|incorrect address|not a good address|insufficient information|no such address|not enough information|wrong ticket|unknown code|no attachment"
      ) | RESOLUTION_CODE == "INSUF")

uhh <- CE %>% 
  filter(
    str_detect(
      RESOLUTION_SUMMARY, "901-"), !str_detect(RESOLUTION_SUMMARY, "please contact"))

yard <- CE %>% filter(
  str_detect(RESOLUTION_CODE, "CVOYC|VOYC") | 
    str_detect(REQUEST_TYPE, "Yard|Weeds"))
car <- CE %>% filter(
  str_detect(RESOLUTION_CODE, "CVOAR|VOAR|CVOAT") | 
    str_detect(REQUEST_TYPE, "Vehicle"))
SHELBY <- CE %>% 
  filter(RESOLUTION_CODE == "SHELBY" | 
  str_detect(RESOLUTION_SUMMARY, "shelby county"))
COVID <- CE %>% filter(str_detect(RESOLUTION_CODE, "COVID"))

tntmv <- CE %>% filter(str_detect(RESOLUTION_SUMMARY, "tenant"), str_detect(RESOLUTION_SUMMARY, "moved"))
```

```{r eval=FALSE, include=FALSE}
noinfo <- CE %>% 
  filter(
    str_detect(
      RESOLUTION_SUMMARY, 
      "^comp. v.o. - miscellaneous$|^resolved$|^closed void$|^in compliance$|^closed, other$|^uncooperative$|^cvom$|^closed$|^vom$|^active npa case$|^dismissed$|^repaired$|^repairs made$|^administrative referral$|^jw-dm$|^jw-rh$|^case not justified$|^comp. v.o. bldg. repaired$|^not justified at the time of inspection$|^not justified$|^case dismissed$|^nj$|^closed, rehab$|^at the time of inspection the violation has been corrected$|^demolished by condemnation$|^violation has been corrected$|^close board and secure$|^not justified at time of inspection$|^not justified per inspection$|^corrected$|^incompliance$|^property rehabbed$|^rehabbed$"))

tidy2 <- CE %>% filter(
    !str_detect(
      RESOLUTION_SUMMARY, "^repaired$|^repairs made$|^comp. v.o. - miscellaneous$|^resolved$|^closed void$|^in compliance$|^closed, other$|^uncooperative$|^cvom$|^closed$|^vom$|^active npa case$|^dismissed$|sr|see#|service request|see #|^administrative referral$|^jw-dm$|^jw-rh$|^case not justified$|^comp. v.o. bldg. repaired$|^not justified at the time of inspection$|^not justified$|^case dismissed$|^nj$|duplicate|^closed, rehab$|wrong address|incorrect address|not a good address|insufficient information|no such address|not enough information|wrong ticket|unknown code|no attachment|^at the time of inspection the violation has been corrected$|^demolished by condemnation$|^violation has been corrected$|^close board and secure$|^not justified at time of inspection$|^not justified per inspection$|^corrected$|^incompliance$|shelby county|^property rehabbed$|^rehabbed$"
      ),
    !str_detect(RESOLUTION_CODE, "CVOYC|VOYC|CVOAR|VOAR|CVOAT|SHELBY|COVID|JA|INSUF"
    ),
    !str_detect(REQUEST_TYPE, "Yard|Weeds|Vehicle")
    )

tt2 <- tidy2 %>% count(RESOLUTION_SUMMARY) %>% arrange(desc(n))
tt3 <- tidy2 %>% count(RESOLUTION_CODE) %>% arrange(desc(n))
```

```{r eval=FALSE, include=FALSE}
admin <- CE %>% filter(str_detect(RESOLUTION_SUMMARY, "please contact|wrong department|thank you for") | RESOLUTION_CODE == "BACK TO MCSC")

#' RESOLUTION CODES
NJ <- CE %>% filter(RESOLUTION_CODE == "NJ") #' Not Justified
NPA <- CE %>% filter(str_detect(RESOLUTION_CODE, "NPA")) #' NPA 
legal <- CE %>% filter(str_detect(RESOLUTION_CODE, "HH|HD|CTCNT|SUMM|DISM|FM-7|FM12|NPF11|SC"))

#' STRUCTURE RELATED
bldg <- CE %>% filter(
  str_detect(RESOLUTION_CODE, "CR|CVOBR|JW-RH|CVOBD|CD") | 
    str_detect(RESOLUTION_SUMMARY, "roof|flooring|tenant|structural|windows|carpet"))

tidy <-
  CE %>% filter(
    !str_detect(RESOLUTION_SUMMARY, "sr|wrong address|please contact|refer to|see#|see #|service request|incorrect address|not a good address|insufficient information|no such address|roof|flooring|tenant|not enough information|wrong department|structural|wrong ticket|thank you for|^comp. v.o. - miscellaneous$|^resolved$|^closed void$|^in compliance$|^closed, other$|^uncooperative$|^cvom$|unknown code|no attachment|windows|carpet|^closed$|^vom$"), 
    !str_detect(RESOLUTION_CODE, "JA|CVOYC|NJ|CVOAR|NPA|SHELBY|VOYC|VOAR|CR|HH|HD|CTCNT|SUMM|CVOBR|CVOAT|DISM|JW-RH|FM-7|CVOBD|BACK TO MCSC|INSUF|FM12|NPF11|COVID|CD|SC"
    ),
    !str_detect(REQUEST_TYPE, "Yard|Weeds|Vehicle")
  )

t2 <- tidy %>% count(RESOLUTION_SUMMARY) %>% arrange(desc(n))
t3 <- tidy %>% count(RESOLUTION_CODE) %>% arrange(desc(n))
```

We can see certain trends using keywords. Here are rows containing the word "tenant" and "moved" or "evict".

```{r echo=FALSE}
tntmv <- CE %>% 
  filter(
    str_detect(RESOLUTION_SUMMARY, "tenant|tennant|tenenat|tenet|teneant|tenent"), 
    str_detect(RESOLUTION_SUMMARY, " moved|evict")) %>% 
  arrange(desc(LAST_MODIFIED_DATE)) %>% 
  rename(sr = INCIDENT_NUMBER)

library(DT)
tntmv_tbl <- tntmv %>% select(sr, RESOLUTION_SUMMARY, ADDRESS1, REPORTED_DATE, everything())
datatable(tntmv_tbl)
```

In the above table, the vast majority of cases are filed under "Code Miscellaneous" (305 of 357 rows). Clearly there is opportunity for a new `REQUEST_TYPE` category to sort these cases.

I would like to draw your attention to sr \#4569338:

> per: tenant jessica they moved due to respiratory problems from the mold/mildew like substance

This led me to searching the word "mold", shown in the table below.

```{r echo=FALSE}
mold <- CE %>% 
  filter(
    str_detect(RESOLUTION_SUMMARY, "mold")) %>% 
  arrange(desc(LAST_MODIFIED_DATE)) %>% 
  rename(sr = INCIDENT_NUMBER) 

mold_tbl <- mold %>% select(sr, RESOLUTION_SUMMARY, ADDRESS1, REPORTED_DATE, everything())
datatable(mold_tbl) 
```

This search shows that many cases involving tenants do not even mention the word tenant. Sometimes "occupant" or "resident" is used. Other times they are never mentioned; the summary may state a notice was sent to the owner, or make no mention of people at all. This makes it very hard to find information specifically about rental units. How are we to know the extent of the problem?
